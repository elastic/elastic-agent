---
name: update-agent-versions

on:
  schedule:
    - cron: "0 0 * * *"

jobs:
  update_versions:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          # no depth limit
          # so, we can generate snapshot versions based on release branches
          fetch-depth: 0

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: 1.21

      - name: Set up branch
        run: git checkout -b update-agent-versions-$GITHUB_RUN_ID

      - name: Install mage
        uses: magefile/mage-action@v3
        with:
          version: v1.13.0
          install-only: true

      - name: Update versions file
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: ./.github/workflows/bump-agent-versions.sh
