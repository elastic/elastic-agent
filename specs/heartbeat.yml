version: 2
inputs:
  - name: synthetics/synthetics
    description: "Synthetics Browser Monitor"
    platforms: &platforms
      - linux/amd64
      - linux/arm64
      - darwin/amd64
      - darwin/arm64
      - windows/amd64
      - container/amd64
      - container/arm64
    outputs: &outputs
      - elasticsearch
      - kafka
      - logstash
      - redis
    command:
      args: &args
        - "-E"
        - "setup.ilm.enabled=false"
        - "-E"
        - "setup.template.enabled=false"
        - "-E"
        - "management.enabled=true"
        - "-E"
        - "logging.level=debug"
        - "-E"
        - "gc_percent=${HEARTBEAT_GOGC:100}"
  - name: synthetics/http
    description: "Synthetics HTTP Monitor"
    platforms: *platforms
    outputs: *outputs
    command:
      args: *args
  - name: synthetics/icmp
    description: "Synthetics ICMP Monitor"
    platforms: *platforms
    outputs: *outputs
    command:
      args: *args
  - name: synthetics/tcp
    description: "Synthetics TCP Monitor"
    platforms: *platforms
    outputs: *outputs
    command:
      args: *args

# backward compatibility, remove with new inputs
restart_on_output_change: true
rules:
  - fix_stream: {}
  - filter_values_with_regexp:
      key: type
      re: ^synthetics/.+
      selector: inputs
  - filter_values:
      selector: inputs
      key: enabled
      values:
        - true
  - inject_agent_info: {}
  - filter:
      selectors:
        - inputs
        - output
        - keystore
when: length(${inputs}) > 0 and hasKey(${output}, 'elasticsearch', 'redis',
  'kafka', 'logstash')
