name: cloudbeat
inputs:
  - name: cloudbeat
    description: "Cloudbeat"
    platforms:
      - linux/386
      - linux/amd64
      - linux/arm64
      - linux/ppc64le
      - darwin/amd64
      - darwin/arm64
      - windows/amd64
      - windows/arm64
    command:
      - args: [
          "-E", "setup.ilm.enabled=false",
          "-E", "setup.template.enabled=false",
          "-E", "management.enabled=true",
        ]
    outputs:
      - elasticsearch
      - redis
      - kafka
      - logstash

# backward compatibility, remove with new inputs
restart_on_output_change: true
action_input_types:
  - cloudbeat

rules:
  - fix_stream: {}
  - inject_index:
      type: logs

  - inject_stream_processor:
      on_conflict: insert_after
      type: logs

  - filter_values:
      selector: inputs
      key: type
      values:
        - cloudbeat

  - inject_agent_info: {}

  - filter:
      selectors:
        - inputs
        - output

when: length(${inputs}) > 0 and hasKey(${output}, 'elasticsearch', 'redis', 'kafka', 'logstash')
