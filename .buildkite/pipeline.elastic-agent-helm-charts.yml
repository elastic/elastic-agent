# yaml-language-server: $schema=https://raw.githubusercontent.com/buildkite/pipeline-schema/main/schema.json
env:
  HELM_REPO_ENV: ${HELM_REPO_ENV:-"dev"}

steps:
  - label: ":elastic-stack: Create helm chart"
    command: |
      .buildkite/scripts/steps/helm-charts.sh
    plugins:
      - elastic/oblt-google-auth#feature/support-different-projects:
          lifetime: 1800 # seconds
          project-id: "elastic-observability-ci"
          project-number: "911195782929"
    agents:
      provider: "gcp"
      machineType: "n1-standard-8"

  - wait: ~

  - command: |
      .buildkite/scripts/steps/trigger-publish-helm-charts.sh
      .buildkite/scripts/steps/trigger-publish-helm-charts.sh | buildkite-agent pipeline upload
