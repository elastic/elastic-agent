# yaml-language-server: $schema=https://raw.githubusercontent.com/buildkite/pipeline-schema/main/schema.json

steps:

  - label: ":elastic-stack: Create helm chart"
    command: |
      .buildkite/scripts/steps/helm-charts.sh
    plugins:
      - elastic/oblt-google-auth#v1.0.0:
          lifetime: 1800 # seconds
    agents:
      provider: "gcp"
      machineType: "n1-standard-8"

  - label: ":elastic-stack: Google bucket access"
    command: |
      echo "Credentials are located at \$GOOGLE_APPLICATION_CREDENTIALS"
      gcloud storage buckets list || true
    plugins:
      - elastic/oblt-google-auth#v1.0.0:
          lifetime: 1800 # seconds
    agents:
      provider: "gcp"
      machineType: "n1-standard-8"

  - wait: ~

  - label: ":elastic-stack: Publish helm chart"
    command: |
      echo "TBC"
