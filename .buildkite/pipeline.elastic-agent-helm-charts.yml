# yaml-language-server: $schema=https://raw.githubusercontent.com/buildkite/pipeline-schema/main/schema.json

steps:

  - label: ":elastic-stack: Create helm chart"
    command: |
      .buildkite/scripts/steps/helm-charts.sh
      gcloud storage cp elastic-agent-*.tgz gs://elastic-agent-helm-chart --print-created-message
    plugins:
      - elastic/oblt-google-auth#v1.0.0:
          lifetime: 1800 # seconds
    agents:
      provider: "gcp"
      machineType: "n1-standard-8"

  - wait: ~

  - label: ":elastic-stack: Publish helm chart"
    command: |
      echo "TBC"
