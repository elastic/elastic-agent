# yaml-language-server: $schema=https://raw.githubusercontent.com/buildkite/pipeline-schema/main/schema.json

env:
  VAULT_PATH: "kv/ci-shared/observability-ingest/cloud/gcp"
  DOCKER_REGISTRY: "docker.elastic.co"
steps:
  - label: "Integration tests"
    key: "integration-tests"
    command: ".buildkite/scripts/steps/integration_tests.sh"
    artifact_paths:
      - "build/TEST-**"
      - "build/diagnostics/*"
    agents:
      provider: "gcp"
      machineType: "n1-standard-8"

  - wait: ~
    continue_on_failure: true
  - label: "Processing test results"
    agents:
      provider: "gcp"
    plugins:
      - junit-annotate#v2.4.1:
          artifacts: build/TEST-go-*.xml
